<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Summary Report</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #fff; }
    h1 { text-align: center; }
    .summary-container { max-width: 600px; margin: auto; border: 1px solid #ccc; padding: 20px; border-radius: 10px; }
    .section { margin-bottom: 20px; }
    .section-title { font-weight: bold; font-size: 16px; margin-bottom: 5px; color: #0077cc; border-bottom: 1px solid #ddd; padding-bottom: 3px; }
    .item { margin: 4px 0; }
    .button-group { display: flex; gap: 10px; margin-top: 15px; }
    .button-group button {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
    }
    #shareBtn { background: #25D366; } /* WhatsApp 绿色 */
    #backBtn { background: #0077cc; }  /* Back 蓝色 */
    #status { margin-top: 10px; font-size: 14px; }
  </style>
  <link rel="manifest" href="/manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js');
    }
  </script>
</head>
<body>
  <h1>Summary Report</h1>
  <div class="summary-container" id="summary"></div>
  <div class="button-group">
    <button id="shareBtn">WhatsApp</button>
    <button id="backBtn">Back</button>
  </div>
  <div id="status"></div>

  <script>
    const data = JSON.parse(sessionStorage.getItem("salesData") || "{}");

    const summaryText = `
Location: ${data.location}
Date: ${data.date}
Closing Person: ${data.closingPerson}

[Sales & Settlement]
- Sales: ${data.sales}
- Credit: ${data.credit}
- Debit: ${data.debit}
- TNG: ${data.tng}
- Bank ATM: ${data.bankAtm}
- Cash: ${data.cash}

[Sell & Wastage]
- Bread Sell: ${data.breadSell}
- Bread Left: ${data.breadLeft}
- Bread Left (12pm): ${data.breadLeftCollected}
- Egg Tart: ${data.eggTart}

[Cake Selling Volume]
- Birthday Cake: ${data.birthdayCake}
`.trim();

    const htmlContent = `
      <div class="section">
        <div class="section-title">Details</div>
        <div class="item">Location: ${data.location}</div>
        <div class="item">Date: ${data.date}</div>
        <div class="item">Closing Person: ${data.closingPerson}</div>
      </div>
      <div class="section">
        <div class="section-title">Sales & Settlement</div>
        <div class="item">Sales: ${data.sales}</div>
        <div class="item">Credit: ${data.credit}</div>
        <div class="item">Debit: ${data.debit}</div>
        <div class="item">TNG: ${data.tng}</div>
        <div class="item">Bank ATM: ${data.bankAtm}</div>
        <div class="item">Cash: ${data.cash}</div>
      </div>
      <div class="section">
        <div class="section-title">Sell & Wastage</div>
        <div class="item">Bread Sell: ${data.breadSell}</div>
        <div class="item">Bread Left: ${data.breadLeft}</div>
        <div class="item">Bread Left (12pm): ${data.breadLeftCollected}</div>
        <div class="item">Egg Tart: ${data.eggTart}</div>
      </div>
      <div class="section">
        <div class="section-title">Cake Selling Volume</div>
        <div class="item">Birthday Cake: ${data.birthdayCake}</div>
      </div>
    `;
    document.getElementById("summary").innerHTML = htmlContent;

    // WhatsApp 分享 + 提交数据
    document.getElementById("shareBtn").onclick = () => {
      const url = `https://wa.me/?text=${encodeURIComponent(summaryText)}`;
      window.open(url, "_blank");

      fetch("https://boreport-backend.onrender.com/submit-report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data, summaryText })
      })
      .then(res => res.json())
      .then(response => {
        document.getElementById("status").textContent = "✅ " + response.message;
        console.log("Server response:", response);
      })
      .catch(err => {
        document.getElementById("status").textContent = "❌ Error: " + err;
        console.error("Error:", err);
      });
    };

    // 返回首页
    document.getElementById("backBtn").onclick = () => {
      window.location.href = "/";
    };
  </script>
</body>
</html>
